### Library

```{r}
#| eval: false
#| echo: true

library("tidyverse")
```
### Loading
```{r}
#| eval: false
#| echo: true

ncbi_clean_pheno <- read_tsv("../data/02_ncbi_clean_pheno.tsv.gz")
ncbi_clean_expr <- read_tsv("../data/02_ncbi_clean_expr.tsv.gz")
```

### BMI class and Age group augmenation:

```{r}
#| eval: false
#| echo: true

ncbi_augment_pheno <- ncbi_clean_pheno |>
  drop_na(maternal_bmi) |>
  mutate(BMI_class = case_when(
    maternal_bmi < 16.5 ~ "Severely underweight",
    16.5 <= maternal_bmi & maternal_bmi < 18.5 ~ "Underweight",
    18.5 <= maternal_bmi & maternal_bmi < 24.9 ~ "Normal weight",
    24.9 <= maternal_bmi & maternal_bmi < 30 ~ "Overweight",
    maternal_bmi >= 30 & maternal_bmi < 35 ~ "Obesity class I",
    maternal_bmi >= 35 & maternal_bmi < 40 ~ "Obesity class II",
    maternal_bmi >= 40 ~ "Obesity class III")) |>
  mutate(BMI_class = factor(BMI_class,
                            levels = c("Severely underweight",
                                       "Underweight",
                                       "Normal weight", 
                                       "Overweight",
                                       "Obesity", 
                                       "Obesity class I",
                                       "Obesity class II", 
                                       "Obesity class III"))
         ) |>
  relocate(BMI_class,.before = maternal_bmi
           ) |>
  select(-maternal_bmi
         ) |>
  mutate(age_group = cut(age, breaks = c(20,30,40,50,
                                         60,70,80))
         ) |>
  relocate(age_group,.before = age
           ) |>
  select(-age)

# Making a joined table
joined_tables <- ncbi_augment_pheno |>
  full_join(ncbi_clean_expr)


```
### Write tsv file
```{r}
#| eval: false
#| echo: true

write_tsv(x = ncbi_augment_pheno,
          file = "../data/04_ncbi_augment_pheno.tsv.gz")

write_tsv(x = ncbi_joined,
          file = "../data/04_ncbi_joined.tsv.gz")
```
